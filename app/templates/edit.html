<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit</title>
</head>
<body>
<h1>Edit {{ entity_name }}</h1>
<div id="input-attributes"></div>
<p>
    <input type="button" value="Edit" onclick="edit_object()">
</p>
<script>
    let entity_name = '{{ entity_name }}';
    let id = '{{ entity_id }}';
    let input_attributes = document.getElementById('input-attributes');

    const request = new XMLHttpRequest();
    request.open('GET', `/models/attributes/${entity_name}`, false);
    request.send();
    let attributes = JSON.parse(request.response).json_list;

    request.open('GET', `/models/${entity_name}/${id}`, false);
    request.send();
    console.log(request.response);
    let object_data = JSON.parse(request.response);

    for (let i in attributes) {
        let paragraph = document.createElement('p');
        console.log(attributes[i]);
        let label_attribute = document.createElement('label');
        label_attribute.textContent = attributes[i];

        let input_attribute = document.createElement('input');
        input_attribute.type = 'text';
        input_attribute.id = attributes[i];

        input_attribute.value = object_data[attributes[i]];

        paragraph.appendChild(label_attribute);
        paragraph.appendChild(input_attribute);
        input_attributes.appendChild(paragraph);
    }

    function edit_object() {
        const request = new XMLHttpRequest();
        request.open('PUT', `/models/${entity_name}/${id}`, true);
        request.setRequestHeader('Content-type', 'application/json; charset=utf-8');
        let json = {};
        for (let i in attributes) {
            json[attributes[i]] = document.getElementById(attributes[i]).value;
        }
        request.send(JSON.stringify(json));
        request.onreadystatechange = function () {
            if (request.readyState === 4) {
                console.log(request.response);
                if (request.status === 200) {
                    window.location.href = `/sqlite_decrypter/${entity_name}`;
                } else alert(JSON.parse(request.response).message);
            }
        }
    }
</script>
</body>
</html>